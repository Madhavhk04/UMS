<div class="popup-container">
    <h2><i class="fas fa-tasks"></i> Manage Assignments</h2>
    <p>Add, edit, or delete assignments</p>

    <!-- Add New Assignment Form -->
    <div class="add-assignment-section">
        <button class="btn btn-primary" onclick="toggleAddForm()">
            <i class="fas fa-plus"></i> Add New Assignment
        </button>

        <div id="addAssignmentForm" class="assignment-form" style="display: none;">
            <h3>Create New Assignment</h3>
            <form method="POST" action="{{ url_for('add_assignment') }}" onsubmit="handleAssignmentSubmit(event, this)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Subject</label>
                        <select name="subject_id" required>
                            <option value="">Select Subject</option>
                            {% for subject in subjects %}
                            <option value="{{ subject.id }}">{{ subject.subject_code }} - {{ subject.subject_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" name="due_date" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" placeholder="e.g., Database Project" required>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" placeholder="Assignment details..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="toggleAddForm()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create Assignment
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Assignments List -->
    <div class="assignments-list">
        <h3>Current Assignments</h3>

        {% if assignments %}
        {% for assignment in assignments %}
        <div class="assignment-item" id="assignment-{{ assignment.id }}">
            <div class="assignment-details">
                <div class="assignment-header">
                    <h4>{{ assignment.title }}</h4>
                    <span class="subject-badge">{{ assignment.subject_code }}</span>
                </div>
                <p class="subject-name">{{ assignment.subject_name }}</p>
                {% if assignment.description %}
                <p class="description">{{ assignment.description }}</p>
                {% endif %}
                <div class="assignment-meta">
                    <span class="due-date">
                        <i class="fas fa-calendar"></i> Due: {{ assignment.due_date }}
                    </span>
                    <span class="status-badge status-{{ assignment.status }}">
                        {{ assignment.status|title }}
                    </span>
                </div>
            </div>

            <div class="assignment-actions">
                <button class="btn-icon" onclick="editAssignment({{ assignment.id }})" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon delete"
                    onclick="deleteAssignment({{ assignment.id }}, '{{ assignment.title }}')" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </div>

            <!-- Edit Form (Hidden) -->
            <div id="edit-form-{{ assignment.id }}" class="edit-form" style="display: none;">
                <form method="POST" action="{{ url_for('edit_assignment', assignment_id=assignment.id) }}"
                    onsubmit="handleAssignmentSubmit(event, this)">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" name="title" value="{{ assignment.title }}" required>
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea name="description" rows="3">{{ assignment.description }}</textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Due Date</label>
                            <input type="date" name="due_date" value="{{ assignment.due_date }}" required>
                        </div>

                        <div class="form-group">
                            <label>Status</label>
                            <select name="status">
                                <option value="pending" {% if assignment.status=='pending' %}selected{% endif %}>Pending
                                </option>
                                <option value="upcoming" {% if assignment.status=='upcoming' %}selected{% endif %}>
                                    Upcoming</option>
                                <option value="completed" {% if assignment.status=='completed' %}selected{% endif %}>
                                    Completed</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline btn-sm"
                            onclick="cancelEdit({{ assignment.id }})">Cancel</button>
                        <button type="submit" class="btn btn-primary btn-sm">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="empty-state">
            <i class="fas fa-clipboard"></i>
            <p>No assignments created yet</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
    .popup-container {
        padding: 20px;
    }

    .popup-container h2 {
        margin-bottom: 10px;
        color: #333;
    }

    .popup-container>p {
        color: #666;
        margin-bottom: 20px;
    }

    .add-assignment-section {
        margin-bottom: 30px;
    }

    .assignment-form {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-top: 15px;
        border: 2px solid #e0e0e0;
    }

    .assignment-form h3 {
        margin-bottom: 20px;
        color: #333;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
        font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 5px;
        font-size: 14px;
        font-family: inherit;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }

    .form-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 15px;
    }

    .assignments-list h3 {
        margin-bottom: 20px;
        color: #333;
    }

    .assignment-item {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
    }

    .assignment-details {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .assignment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .assignment-header h4 {
        font-size: 18px;
        color: #333;
    }

    .subject-badge {
        background: #667eea;
        color: white;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
    }

    .subject-name {
        color: #667eea;
        font-size: 14px;
        font-weight: 600;
    }

    .description {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
    }

    .assignment-meta {
        display: flex;
        gap: 20px;
        align-items: center;
    }

    .due-date {
        color: #666;
        font-size: 13px;
    }

    .status-badge {
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
    }

    .status-pending {
        background: #fef3c7;
        color: #92400e;
    }

    .status-upcoming {
        background: #dbeafe;
        color: #1e40af;
    }

    .status-completed {
        background: #d1fae5;
        color: #065f46;
    }

    .assignment-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #f0f0f0;
    }

    .btn-icon {
        width: 36px;
        height: 36px;
        border: none;
        background: #f0f0f0;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-icon:hover {
        background: #667eea;
        color: white;
    }

    .btn-icon.delete:hover {
        background: #ef4444;
        color: white;
    }

    .edit-form {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px solid #f0f0f0;
    }

    .empty-state {
        text-align: center;
        padding: 40px;
        color: #999;
    }

    .empty-state i {
        font-size: 48px;
        margin-bottom: 15px;
    }
</style>